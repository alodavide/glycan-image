<!-- Imports polymer -->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-image/iron-image.html">

<!-- Defines element markup -->
<dom-module id="glycan-image" >
    <
    <template>
        <iron-ajax
            id="imageAjaxCall"
            contentType="application/json"
            method="POST"
            on-response="handleResponse"
            on-error="handleError"
            debounce-duration="300"></iron-ajax>

        <iron-image id="glycanImage"></iron-image>
    </template>
    <!-- Registers custom element -->
    <script>
    Polymer({
        is: 'glycan-image',
        properties:{
            notation: String,
            server: String,
            structure: {
                type: String,
                observer: '_structureChanged'
            }
        },

        handleResponse: function(data){
            var image = this.$.glycanImage;
            image.innerHTML = new window.XMLSerializer().serializeToString(data.detail.response);

        },

        handleError: function(ev, res){
            var image = this.$.glycanImage;
            image.src = this.resolveUrl("img/sorry.jpg");
        },

        _structureChanged: function(newValue, oldValue) {
            if(newValue){
                var call = this.$.imageAjaxCall;
                if(this.server.charAt(this.server.length - 1) === "/"){
                    call.url= this.server+"glycoUtils/utils/image/generate"
                } else {
                    call.url= this.server+"/glycoUtils/utils/image/generate"
                }
                call.handleAs="xml";
                call.contentType ="application/json";
                call.body = '{"glycoCtCode":"'+this.structure+'", "notation":"'+this.notation+'"}';
                call.generateRequest();
            } else{
                var image = this.$.glycanImage;
                image.src = this.resolveUrl("img/sorry.jpg")
            }
        }

    });
    </script>
</dom-module>
